<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>VR Fisika</title>
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/aframe-extras@6.1.1/dist/aframe-extras.min.js"></script>
    <script src="https://unpkg.com/aframe-event-set-component/dist/aframe-event-set-component.min.js"></script>
    <script src="https://unpkg.com/aframe-physics-system@v4.2.2/dist/aframe-physics-system.min.js"></script>
  </head>
  <body>
    <a-scene 
      vr-mode-ui="enabled: false" 
      embedded 
      style="height: 100vh;"
      renderer="physicallyCorrectLights: true"
      physics="gravity: -9.8; debug: false">
      
      
      <!-- Assets - Conditional Loading -->
      <a-assets timeout="10000">
        <img id="thumbScene1" crossorigin="anonymous" src="https://cdn.aframe.io/link-traversal/thumbs/forest.png" />
        <!-- Fallback untuk jika GLB tidak tersedia -->
        <a-mixin id="fallback-box"
                 geometry="primitive: box; width: 2; height: 1; depth: 1"
                 material="color: #8B4513"></a-mixin>
        <a-mixin id="fallback-ground" 
                 geometry="primitive: plane; width: 20; height: 20"
                 material="color: #228B22"
                 rotation="-90 0 0"></a-mixin>
      </a-assets>

      <a-entity id="environment"></a-entity>

      <a-entity id="fallback-environment">
        <a-plane
          position="0 0 0"
          rotation="-90 0 0"
          width="20"
          height="20"
          color="#228B22"
          shadow="receive: true">
        </a-plane>
        
        <a-plane class="collidable" position="0 2 -10" width="20" height="4" color="#87CEEB"></a-plane>
        <a-plane class="collidable" position="-10 2 0" rotation="0 90 0" width="20" height="4" color="#87CEEB"></a-plane>
        <a-plane class="collidable" position="10 2 0" rotation="0 -90 0" width="20" height="4" color="#87CEEB"></a-plane>
      </a-entity>

      <!-- Portal Kembali ke Menu -->
      <a-link
        position="0 1.6 6"
        rotation="0 180 0"
        link="on: click"
        href="index.html"
        title="Kembali ke Menu"
        image="#thumbScene1"
        class="clickable"
        event-set__mouseenter="material.opacity: 0.8"
        event-set__mouseleave="material.opacity: 0.6">
      </a-link>

      <!-- Sky dan pencahayaan -->
      <a-sky color="#87CEEB"></a-sky>
      <a-light type="ambient" color="#404040" intensity="0.4"></a-light>
      <a-light type="directional" 
               position="5 10 5" 
               intensity="0.6"
               shadow="cast: true; mapSize: 2048">
      </a-light>

      <!-- Kamera dengan gaze cursor -->
      <a-entity 
        id="rig"
        collider="distance: 0.3"
        camera 
        look-controls 
        wasd-controls 
        position="0 1.2 3" 
        kinematic-body="radius: 0.3; height: 1.6;"
        sphere-collider="radius: 0.3">
          <a-entity
            id="reticle"
            position="0 0 -1"
            geometry="primitive: ring; radiusInner: 0.018; radiusOuter: 0.025"
            material="shader: flat; opacity: 0.9; color: #fff; depthTest: false"
            cursor="fuse: true; fuseTimeout: 1200"
            raycaster="objects: .clickable"
            animation__fuse="property: scale; startEvents: fusing; from: 1 1 1; to: 0.2 0.2 0.2; dur: 1200; easing: linear"
            animation__reset="property: scale; startEvents: mouseleave; to: 1 1 1; dur: 120">
          </a-entity>
      </a-entity>
      
      <!-- Main Menu -->
      <a-entity id="mainmenu">
        <a-text 
          value="PILIH SIMULASI FISIKA" 
          position="0 2.3 -0.5" 
          align="center" 
          color="white" 
          width="8"
          scale="1.5 1.5 1.5"
          material="depthTest: false; transparent: true"
          geometry="primitive: plane; width: auto; height: auto"
          text="shader: msdf; font: roboto">
        </a-text>
        
        <a-entity position="-0.8 1.4 -0.5" rotation="0 0 0">
          <a-box 
            id="btnBab2" 
            class="clickable"
            depth="0.1" 
            height="0.8" 
            width="1.2" 
            color="#2e88ff"
            material="depthTest: true"
            event-set__enter="_event: mouseenter; scale:1.06 1.06 1.06; color:#7bdcff"
            event-set__leave="_event: mouseleave; scale:1 1 1; color:#2e88ff">
          </a-box>
          <a-text 
            value="Gaya Gesek" 
            color="#fff" 
            align="center" 
            width="4" 
            position="0 0 0.06"
            material="depthTest: false; transparent: true">
          </a-text>
        </a-entity>
        
        <a-entity position="0.8 1.4 -0.5" rotation="0 0 0">
          <a-box 
            id="btnBab3" 
            class="clickable"
            depth="0.1" 
            height="0.8" 
            width="1.2" 
            color="#2e88ff"
            material="depthTest: true"
            event-set__enter="_event: mouseenter; scale:1.06 1.06 1.06; color:#7bdcff"
            event-set__leave="_event: mouseleave; scale:1 1 1; color:#2e88ff">
          </a-box>
          <a-text 
            value="Tumbukan" 
            color="#fff" 
            align="center" 
            width="4" 
            position="0 0 0.06"
            material="depthTest: false; transparent: true">
          </a-text>
        </a-entity>
      </a-entity>

      <!-- Bab 2 - Gaya Gesek -->
      <a-entity id="bab2" visible="false">
        <!-- Model placeholder - akan diganti dengan GLB jika tersedia -->
        <a-entity id="myModel" position="0 0.6 -3" rotation="0 -90 0" scale="0.5 0.5 0.5">
          <!-- Fallback model -->
          <a-box 
            id="blockModel"
            class="collidable"
            width="2" 
            height="1" 
            depth="1" 
            color="#8B4513"
            material="depthTest: true"
            shadow="cast: true">
          </a-box>
          <a-plane 
            class="collidable"
            position="0 -0.6 0" 
            rotation="-90 0 0" 
            width="4" 
            height="4" 
            color="#696969"
            material="depthTest: true">
          </a-plane>
        </a-entity>

        <a-text 
          id="statusText"
          value="Ada sebuah balok di permukaan kasar"
          position="0 1.9 -3"
          align="center"
          color="white"
          width="4"
          material="depthTest: false; transparent: true">
        </a-text>


        <!-- Tombol Skema 1 -->
        <a-entity position="1.5 1.8 -1" rotation="0 -45 0" id="btnSkema1Wrapper">
          <a-box 
            id="btnSkema1"
            class="clickable"
            depth="0.1" 
            height="0.2" 
            width="0.8" 
            color="#2e88ff"
            material="depthTest: true"
            event-set__enter="_event: mouseenter; scale:1.06 1.06 1.06; color:#7bdcff"
            event-set__leave="_event: mouseleave; scale:1 1 1; color:#2e88ff">
          </a-box>
          <a-text 
            value="Tarik Perlahan" 
            color="#fff" 
            align="center" 
            width="2" 
            position="0 0 0.06"
            material="depthTest: false; transparent: true">
          </a-text>
        </a-entity>

        <!-- Tombol Skema 2 -->
        <a-entity position="1.5 1.55 -1" visible="false" rotation="0 -45 0" id="btnSkema2Wrapper">
          <a-box 
            id="btnSkema2"
            depth="0.1" 
            height="0.2" 
            width="0.8" 
            color="#ff9b2f"
            material="depthTest: true"
            event-set__enter="_event: mouseenter; scale:1.06 1.06 1.06; color:#ffd29b"
            event-set__leave="_event: mouseleave; scale:1 1 1; color:#ff9b2f">
          </a-box>
          <a-text 
            value="Tarik Lebih Kuat" 
            color="#fff" 
            align="center" 
            width="2" 
            position="0 0 0.06"
            material="depthTest: false; transparent: true">
          </a-text>
        </a-entity>

        <!-- Tombol Skema 3 -->
        <a-entity position="1.5 1.3 -1" visible="false" rotation="0 -45 0" id="btnSkema3Wrapper">
          <a-box 
            id="btnSkema3"
            depth="0.1" 
            height="0.2" 
            width="0.8" 
            color="#ff4d4d"
            material="depthTest: true"
            event-set__enter="_event: mouseenter; scale:1.06 1.06 1.06; color:#ff9b9b"
            event-set__leave="_event: mouseleave; scale:1 1 1; color:#ff4d4d">
          </a-box>
          <a-text 
            value="Tarik Sangat Kuat" 
            color="#fff" 
            align="center" 
            width="2" 
            position="0 0 0.06"
            material="depthTest: false; transparent: true">
          </a-text>
        </a-entity>

        <!-- Tombol Kembali dan Reset -->
        <a-entity position="-0.5 0.8 -1" rotation="-30 0 0">
          <a-box 
            id="btnKembali2"
            class="clickable"
            depth="0.1" 
            height="0.2" 
            width="0.6" 
            color="#008800"
            material="depthTest: true"
            event-set__enter="_event: mouseenter; scale:1.06 1.06 1.06; color:#81db81"
            event-set__leave="_event: mouseleave; scale:1 1 1; color:#008800">
          </a-box>
          <a-text 
            value="Kembali" 
            color="#fff" 
            align="center" 
            width="2" 
            position="0 0 0.06"
            material="depthTest: false; transparent: true">
          </a-text>
        </a-entity>

        <a-entity position="0.5 0.8 -1" rotation="-30 0 0">
          <a-box 
            id="btnReset2"
            class="clickable"
            depth="0.1" 
            height="0.2" 
            width="0.6" 
            color="#008800"
            material="depthTest: true"
            event-set__enter="_event: mouseenter; scale:1.06 1.06 1.06; color:#81db81"
            event-set__leave="_event: mouseleave; scale:1 1 1; color:#008800">
          </a-box>
          <a-text 
            value="Reset" 
            color="#fff" 
            align="center" 
            width="2" 
            position="0 0 0.06"
            material="depthTest: false; transparent: true">
          </a-text>
        </a-entity>
      </a-entity>

      <!-- Bab 3 - Tumbukan -->
      <a-entity id="bab3" visible="false">
        <!-- Bola-bola untuk simulasi tumbukan -->
        <a-sphere 
          id="ball1" 
          class="collidable"
          position="-4 1 -3" 
          radius="0.25" 
          color="#cc2f2f"
          material="depthTest: true"
          shadow="cast: true">
        </a-sphere>
        <a-text 
          id="label1" 
          value="m1 = 1kg&#10;v1 = 1m/s" 
          position="-4 2 -3" 
          align="center"
          color="white"
          material="depthTest: false; transparent: true">
        </a-text>
        
        <a-sphere 
          id="ball2" 
          class="collidable"
          position="4 1 -3" 
          radius="0.25" 
          color="#4545ff"
          material="depthTest: true"
          shadow="cast: true">
        </a-sphere>
        <a-text 
          id="label2" 
          value="m2 = 1kg&#10;v2 = -1m/s" 
          position="4 2 -3" 
          align="center"
          color="white"
          material="depthTest: false; transparent: true">
        </a-text>
        
        <!-- UI Controls untuk Bola Biru -->
        <a-entity id="UIbiruWrapper">
          <a-text 
            value="Massa Bola Biru" 
            position="1.3 1.89 -1" 
            scale="0.3 0.3 0.3" 
            rotation="0 -55 0" 
            align="center"
            color="white"
            material="depthTest: false; transparent: true">
          </a-text>
          
          <a-entity position="1.3 1.7 -1.2" rotation="0 -55 0">
            <a-box 
              id="btnM21"
              class="clickable"
              depth="0.1" 
              height="0.2" 
              width="0.3" 
              color="#2e88ff"
              material="depthTest: true"
              event-set__enter="_event: mouseenter; scale:1.06 1.06 1.06; color:#7bdcff"
              event-set__leave="_event: mouseleave; scale:1 1 1; color:#2e88ff">
            </a-box>
            <a-text 
              value="1Kg" 
              color="#fff" 
              align="center" 
              width="2" 
              position="0 0 0.06"
              material="depthTest: false; transparent: true">
            </a-text>
          </a-entity>
          
          <a-entity position="1.49 1.7 -0.93" rotation="0 -55 0">
            <a-box 
              id="btnM22"
              class="clickable"
              depth="0.1" 
              height="0.2" 
              width="0.3" 
              color="#2e88ff"
              material="depthTest: true"
              event-set__enter="_event: mouseenter; scale:1.06 1.06 1.06; color:#7bdcff"
              event-set__leave="_event: mouseleave; scale:1 1 1; color:#2e88ff">
            </a-box>
            <a-text 
              value="2Kg" 
              color="#fff" 
              align="center" 
              width="2" 
              position="0 0 0.06"
              material="depthTest: false; transparent: true">
            </a-text>
          </a-entity>

          <a-text 
            value="Kecepatan Bola Biru" 
            position="1.3 1.5 -1" 
            scale="0.3 0.3 0.3" 
            rotation="0 -55 0" 
            align="center"
            color="white"
            material="depthTest: false; transparent: true">
          </a-text>
          
          <a-entity position="1.3 1.3 -1.2" rotation="0 -55 0">
            <a-box 
              id="btnV21"
              class="clickable"
              depth="0.1" 
              height="0.2" 
              width="0.3" 
              color="#2e88ff"
              material="depthTest: true"
              event-set__enter="_event: mouseenter; scale:1.06 1.06 1.06; color:#7bdcff"
              event-set__leave="_event: mouseleave; scale:1 1 1; color:#2e88ff">
            </a-box>
            <a-text 
              value="1m/s" 
              color="#fff" 
              align="center" 
              width="2" 
              position="0 0 0.06"
              material="depthTest: false; transparent: true">
            </a-text>
          </a-entity>
          
          <a-entity position="1.49 1.3 -0.93" rotation="0 -55 0">
            <a-box 
              id="btnV22"
              class="clickable"
              depth="0.1" 
              height="0.2" 
              width="0.3" 
              color="#2e88ff"
              material="depthTest: true"
              event-set__enter="_event: mouseenter; scale:1.06 1.06 1.06; color:#7bdcff"
              event-set__leave="_event: mouseleave; scale:1 1 1; color:#2e88ff">
            </a-box>
            <a-text 
              value="2m/s" 
              color="#fff" 
              align="center" 
              width="2" 
              position="0 0 0.06"
              material="depthTest: false; transparent: true">
            </a-text>
          </a-entity>
        </a-entity>

        <a-entity id="environment">
        <a-plane 
          position="0 -1.1 0" rotation="-90 0 0" 
          width="18" 
          height="30" 
          color="#FF00FF" 
          opacity="0.001" 
          material="transparent: true"
          static-body="" 
          visible="false" ></a-plane>

        <a-box 
          position="0 3 -13" width="18" 
          height="6" 
          depth="0.2" 
          color="#00FFFF" 
          opacity="0.001" 
          material="transparent: true"
          static-body="" 
          visible="false"
        ></a-box>

        <a-box 
          position="0 0.5 -5" width="1" 
          height="0.8" 
          depth="0.7" 
          color="#FFFF00" 
          opacity="0.001" 
          material="transparent: true"
          static-body="" 
          visible="false"
        ></a-box>

        </a-entity>

        <!-- UI Controls untuk Bola Merah -->
        <a-entity id="UImerahWrapper">
          <a-text 
            value="Massa Bola Merah" 
            position="-1.3 1.89 -1" 
            scale="0.3 0.3 0.3" 
            rotation="0 55 0" 
            align="center"
            color="white"
            material="depthTest: false; transparent: true">
          </a-text>
          
          <a-entity position="-1.49 1.7 -0.93" rotation="0 55 0">
            <a-box 
              id="btnM11"
              class="clickable"
              depth="0.1" 
              height="0.2" 
              width="0.3" 
              color="#d82424"
              material="depthTest: true"
              event-set__enter="_event: mouseenter; scale:1.06 1.06 1.06; color:#f4caca"
              event-set__leave="_event: mouseleave; scale:1 1 1; color:#d82424">
            </a-box>
            <a-text 
              value="1Kg" 
              color="#fff" 
              align="center" 
              width="2" 
              position="0 0 0.06"
              material="depthTest: false; transparent: true">
            </a-text>
          </a-entity>
          
          <a-entity position="-1.3 1.7 -1.2" rotation="0 55 0">
            <a-box 
              id="btnM12"
              class="clickable"
              depth="0.1" 
              height="0.2" 
              width="0.3" 
              color="#d82424"
              material="depthTest: true"
              event-set__enter="_event: mouseenter; scale:1.06 1.06 1.06; color:#f4caca"
              event-set__leave="_event: mouseleave; scale:1 1 1; color:#d82424">
            </a-box>
            <a-text 
              value="2Kg" 
              color="#fff" 
              align="center" 
              width="2" 
              position="0 0 0.06"
              material="depthTest: false; transparent: true">
            </a-text>
          </a-entity>

          <a-text 
            value="Kecepatan Bola Merah" 
            position="-1.3 1.5 -1" 
            scale="0.3 0.3 0.3" 
            rotation="0 55 0" 
            align="center"
            color="white"
            material="depthTest: false; transparent: true">
          </a-text>
          
          <a-entity position="-1.49 1.3 -0.93" rotation="0 55 0">
            <a-box 
              id="btnV11"
              class="clickable"
              depth="0.1" 
              height="0.2" 
              width="0.3" 
              color="#d82424"
              material="depthTest: true"
              event-set__enter="_event: mouseenter; scale:1.06 1.06 1.06; color:#f4caca"
              event-set__leave="_event: mouseleave; scale:1 1 1; color:#d82424">
            </a-box>
            <a-text 
              value="1m/s" 
              color="#fff" 
              align="center" 
              width="2" 
              position="0 0 0.06"
              material="depthTest: false; transparent: true">
            </a-text>
          </a-entity>
          
          <a-entity position="-1.3 1.3 -1.2" rotation="0 55 0">
            <a-box 
              id="btnV12"
              class="clickable"
              depth="0.1" 
              height="0.2" 
              width="0.3" 
              color="#d82424"
              material="depthTest: true"
              event-set__enter="_event: mouseenter; scale:1.06 1.06 1.06; color:#f4caca"
              event-set__leave="_event: mouseleave; scale:1 1 1; color:#d82424">
            </a-box>
            <a-text 
              value="2m/s" 
              color="#fff" 
              align="center" 
              width="2" 
              position="0 0 0.06"
              material="depthTest: false; transparent: true">
            </a-text>
          </a-entity>
        </a-entity>
      
        <!-- Tombol Play/Reset dan Kembali -->
        <a-entity position="1 1 1.5" rotation="-10 -30 0">
          <a-box 
            id="btnPlay"
            class="clickable"
            depth="0.1" 
            height="0.2" 
            width="0.6" 
            color="#008800"
            material="depthTest: true"
            event-set__enter="_event: mouseenter; scale:1.06 1.06 1.06; color:#81db81"
            event-set__leave="_event: mouseleave; scale:1 1 1; color:#008800">
          </a-box>
          <a-text 
            id="btnPlayText" 
            value="Start" 
            color="#fff" 
            align="center" 
            width="2" 
            position="0 0 0.06"
            material="depthTest: false; transparent: true">
          </a-text>
        </a-entity>
        
        <a-entity position="-1 1 1.5" rotation="-10 30 0">
          <a-box 
            id="btnKembali3"
            class="clickable"
            depth="0.1" 
            height="0.2" 
            width="0.6" 
            color="#008800"
            material="depthTest: true"
            event-set__enter="_event: mouseenter; scale:1.06 1.06 1.06; color:#81db81"
            event-set__leave="_event: mouseleave; scale:1 1 1; color:#008800">
          </a-box>
          <a-text 
            value="Kembali" 
            color="#fff" 
            align="center" 
            width="2" 
            position="0 0 0.06"
            material="depthTest: false; transparent: true">
          </a-text>
        </a-entity>
      </a-entity>
    </a-scene>

    <script>
      // Flag untuk cek apakah model berhasil dimuat
      let modelsLoaded = false;
      let blockAnimationState = 'idle';
      
      // Variabel global
      const statusText = document.querySelector('#statusText');
      const ball1 = document.querySelector("#ball1");
      const ball2 = document.querySelector("#ball2");
      const label1 = document.querySelector("#label1");
      const label2 = document.querySelector("#label2");
      const btnPlay = document.querySelector("#btnPlay");
      
      let m1 = 1, v1 = 1;
      let m2 = 1, v2 = -1;
      let animating = false;
      let done = false;

      // Coba load model GLB secara opsional
      function loadGLBModels() {
        const myModelEntity = document.querySelector('#myModel');
        
        // Coba load model bab2.glb
        const bab2Model = document.createElement('a-entity');
        bab2Model.setAttribute('gltf-model', 'assets/balok.glb');
        bab2Model.setAttribute('position', '0 0 0');
        bab2Model.setAttribute('scale', '1 1 1');
        bab2Model.setAttribute('material', 'depthTest: true');
        bab2Model.setAttribute('class', 'collidable');
        
        bab2Model.addEventListener('model-loaded', () => {
          console.log('Bab2 model loaded successfully');
          // Sembunyikan fallback model
          document.querySelector('#blockModel').setAttribute('visible', 'false');
          modelsLoaded = true;
        });
        
        bab2Model.addEventListener('model-error', (e) => {
          console.log('Bab2 model failed to load, using fallback');
          // Tetap gunakan fallback model
        });
        
        myModelEntity.appendChild(bab2Model);
        
        // Coba load environment model
        const environment = document.querySelector('#environment');
        const classModel = document.createElement('a-entity');
        classModel.setAttribute('gltf-model', 'assets/class.glb');
        classModel.setAttribute('position', '-2.5 -1 15');
        classModel.setAttribute('scale', '1 1 1');
        classModel.setAttribute('rotation', '0 180 0');
        classModel.setAttribute('material', 'depthTest: true');
        classModel.setAttribute('class', 'collidable');
        
        classModel.addEventListener('model-loaded', () => {
          console.log('Sekolah model loaded successfully');
          document.querySelector('#fallback-environment').setAttribute('visible', 'false');
        });
        
        environment.appendChild(classModel);
        
        // Add collision boxes for classroom furniture
        
        // Main classroom walls
        const classWalls = document.createElement('a-box');
        classWalls.setAttribute('class', 'collidable');
        classWalls.setAttribute('position', '-2.5 2 15');
        classWalls.setAttribute('width', '8');
        classWalls.setAttribute('height', '6');
        classWalls.setAttribute('depth', '8');
        classWalls.setAttribute('visible', 'false');
        environment.appendChild(classWalls);
        
        // Teacher's desk (front center)
        const teacherDesk = document.createElement('a-box');
        teacherDesk.setAttribute('class', 'collidable');
        teacherDesk.setAttribute('position', '-2.5 0.4 11');
        teacherDesk.setAttribute('width', '2');
        teacherDesk.setAttribute('height', '0.8');
        teacherDesk.setAttribute('depth', '1');
        teacherDesk.setAttribute('visible', 'false');
        environment.appendChild(teacherDesk);
        
        // Student desks and chairs - Row 1 (front)
        const desk1 = document.createElement('a-box');
        desk1.setAttribute('class', 'collidable');
        desk1.setAttribute('position', '-4 0.4 13');
        desk1.setAttribute('width', '1.2');
        desk1.setAttribute('height', '0.8');
        desk1.setAttribute('depth', '0.6');
        desk1.setAttribute('visible', 'false');
        environment.appendChild(desk1);
        
        const chair1 = document.createElement('a-box');
        chair1.setAttribute('class', 'collidable');
        chair1.setAttribute('position', '-4 0.4 13.8');
        chair1.setAttribute('width', '0.5');
        chair1.setAttribute('height', '0.8');
        chair1.setAttribute('depth', '0.5');
        chair1.setAttribute('visible', 'false');
        environment.appendChild(chair1);
        
        const desk2 = document.createElement('a-box');
        desk2.setAttribute('class', 'collidable');
        desk2.setAttribute('position', '-1 0.4 13');
        desk2.setAttribute('width', '1.2');
        desk2.setAttribute('height', '0.8');
        desk2.setAttribute('depth', '0.6');
        desk2.setAttribute('visible', 'false');
        environment.appendChild(desk2);
        
        const chair2 = document.createElement('a-box');
        chair2.setAttribute('class', 'collidable');
        chair2.setAttribute('position', '-1 0.4 13.8');
        chair2.setAttribute('width', '0.5');
        chair2.setAttribute('height', '0.8');
        chair2.setAttribute('depth', '0.5');
        chair2.setAttribute('visible', 'false');
        environment.appendChild(chair2);
        
        // Student desks and chairs - Row 2 (middle)
        const desk3 = document.createElement('a-box');
        desk3.setAttribute('class', 'collidable');
        desk3.setAttribute('position', '-4 0.4 15');
        desk3.setAttribute('width', '1.2');
        desk3.setAttribute('height', '0.8');
        desk3.setAttribute('depth', '0.6');
        desk3.setAttribute('visible', 'false');
        environment.appendChild(desk3);
        
        const chair3 = document.createElement('a-box');
        chair3.setAttribute('class', 'collidable');
        chair3.setAttribute('position', '-4 0.4 15.8');
        chair3.setAttribute('width', '0.5');
        chair3.setAttribute('height', '0.8');
        chair3.setAttribute('depth', '0.5');
        chair3.setAttribute('visible', 'false');
        environment.appendChild(chair3);
        
        const desk4 = document.createElement('a-box');
        desk4.setAttribute('class', 'collidable');
        desk4.setAttribute('position', '-1 0.4 15');
        desk4.setAttribute('width', '1.2');
        desk4.setAttribute('height', '0.8');
        desk4.setAttribute('depth', '0.6');
        desk4.setAttribute('visible', 'false');
        environment.appendChild(desk4);
        
        const chair4 = document.createElement('a-box');
        chair4.setAttribute('class', 'collidable');
        chair4.setAttribute('position', '-1 0.4 15.8');
        chair4.setAttribute('width', '0.5');
        chair4.setAttribute('height', '0.8');
        chair4.setAttribute('depth', '0.5');
        chair4.setAttribute('visible', 'false');
        environment.appendChild(chair4);
        
        // Student desks and chairs - Row 3 (back)
        const desk5 = document.createElement('a-box');
        desk5.setAttribute('class', 'collidable');
        desk5.setAttribute('position', '-4 0.4 17');
        desk5.setAttribute('width', '1.2');
        desk5.setAttribute('height', '0.8');
        desk5.setAttribute('depth', '0.6');
        desk5.setAttribute('visible', 'false');
        environment.appendChild(desk5);
        
        const chair5 = document.createElement('a-box');
        chair5.setAttribute('class', 'collidable');
        chair5.setAttribute('position', '-4 0.4 17.8');
        chair5.setAttribute('width', '0.5');
        chair5.setAttribute('height', '0.8');
        chair5.setAttribute('depth', '0.5');
        chair5.setAttribute('visible', 'false');
        environment.appendChild(chair5);
        
        const desk6 = document.createElement('a-box');
        desk6.setAttribute('class', 'collidable');
        desk6.setAttribute('position', '-1 0.4 17');
        desk6.setAttribute('width', '1.2');
        desk6.setAttribute('height', '0.8');
        desk6.setAttribute('depth', '0.6');
        desk6.setAttribute('visible', 'false');
        environment.appendChild(desk6);
        
        const chair6 = document.createElement('a-box');
        chair6.setAttribute('class', 'collidable');
        chair6.setAttribute('position', '-1 0.4 17.8');
        chair6.setAttribute('width', '0.5');
        chair6.setAttribute('height', '0.8');
        chair6.setAttribute('depth', '0.5');
        chair6.setAttribute('visible', 'false');
        environment.appendChild(chair6);
      }

      // Load models setelah DOM ready
      document.addEventListener('DOMContentLoaded', () => {
        loadGLBModels();
        createSpeedTrails();
      });

      // Fungsi untuk membuat efek garis kecepatan
      function createSpeedTrails() {
    // Buat trail untuk ball1
    const trail1 = document.createElement('a-entity');
    trail1.setAttribute('id', 'trail1');
    trail1.setAttribute('position', '-2 1 -3');
    trail1.setAttribute('visible', 'false');
    document.querySelector('a-scene').appendChild(trail1);

    // Buat trail untuk ball2
    const trail2 = document.createElement('a-entity');
    trail2.setAttribute('id', 'trail2');
    trail2.setAttribute('position', '2 1 -3');
    trail2.setAttribute('visible', 'false');
    document.querySelector('a-scene').appendChild(trail2);

        // Buat beberapa segmen trail untuk setiap bola
        for (let i = 0; i < 12; i++) {
    // Trail segments untuk ball1 dengan variasi ukuran dan opacity
    const segment1 = document.createElement('a-cylinder');
    segment1.setAttribute('id', `trail1-segment-${i}`);
    segment1.setAttribute('radius', `${0.03 - i * 0.002}`); // Semakin mengecil
    segment1.setAttribute('height', `${0.4 - i * 0.02}`); // Semakin pendek
    segment1.setAttribute('rotation', '0 0 90');
    segment1.setAttribute('material', {
      color: '#ff4444',
      opacity: Math.max(0.9 - i * 0.07, 0.1),
      transparent: true,
      emissive: '#ff2222',
      emissiveIntensity: 0.3
    });
    segment1.setAttribute('visible', 'false');
    trail1.appendChild(segment1);

    // Trail segments untuk ball2 dengan variasi ukuran dan opacity
    const segment2 = document.createElement('a-cylinder');
    segment2.setAttribute('id', `trail2-segment-${i}`);
    segment2.setAttribute('radius', `${0.03 - i * 0.002}`);
    segment2.setAttribute('height', `${0.4 - i * 0.02}`);
    segment2.setAttribute('rotation', '0 0 90');
    segment2.setAttribute('material', {
      color: '#4444ff',
      opacity: Math.max(0.9 - i * 0.07, 0.1),
      transparent: true,
      emissive: '#2222ff',
      emissiveIntensity: 0.3
    });
    segment2.setAttribute('visible', 'false');
    trail2.appendChild(segment2);
  }
}

      // Fungsi untuk menampilkan trail berdasarkan kecepatan
      function showSpeedTrails(ballId, velocity, position) {
  const trail = document.querySelector(`#trail${ballId}`);
  const absVelocity = Math.abs(velocity);
  
  if (absVelocity > 0.5) { // Tampilkan trail bahkan pada kecepatan rendah
    trail.setAttribute('visible', 'true');
    trail.setAttribute('position', position);
    
    // Animasikan setiap segment dengan delay dan efek yang lebih smooth
    for (let i = 0; i < 12; i++) {
      const segment = document.querySelector(`#trail${ballId}-segment-${i}`);
      segment.setAttribute('visible', 'true');
      
      // Posisi awal berdasarkan kecepatan dan indeks
      const initialOffset = -i * 0.15 * Math.sign(velocity);
      const finalOffset = -(i + 6) * 0.15 * Math.sign(velocity);
      
      setTimeout(() => {
        segment.setAttribute('animation__move', {
          property: 'position',
          from: `${initialOffset} 0 0`,
          to: `${finalOffset} 0 0`,
          dur: 1500,
          easing: 'easeOutQuart'
        });
        
        // Animasi fade out yang lebih smooth
        segment.setAttribute('animation__fade', {
          property: 'material.opacity',
          to: '0',
          dur: 1500,
          delay: 200,
          easing: 'easeOutQuart'
        });
        
        // Animasi scale untuk efek menghilang
        segment.setAttribute('animation__scale', {
          property: 'scale',
          to: '0.5 0.5 0.5',
          dur: 1500,
          delay: 400,
          easing: 'easeOutQuart'
        });
      }, i * 30); // Delay lebih pendek untuk efek yang lebih fluid
    }
          
          // Sembunyikan trail setelah animasi selesai
          setTimeout(() => {
            trail.setAttribute('visible', 'false');
            for (let i = 0; i < 8; i++) {
              const segment = document.querySelector(`#trail${ballId}-segment-${i}`);
              segment.setAttribute('visible', 'false');
              segment.removeAttribute('animation');
            }
          }, 2000);
        }
      }

      // Fungsi untuk membuat efek memantul
      function createBounceEffect(ballElement, intensity = 1) {
        // Efek skala memantul
        ballElement.setAttribute('animation__bounce', {
          property: 'scale',
          from: `${1 + intensity * 0.3} ${0.7} ${1 + intensity * 0.3}`,
          to: '1 1 1',
          dur: 200,
          easing: 'easeOutElastic'
        });

        // Efek partikel sederhana
        createImpactParticles(ballElement);
      }

      // Fungsi untuk membuat partikel saat impact
      function createImpactParticles(ballElement) {
        const ballPosition = ballElement.getAttribute('position');
        
        // Buat beberapa partikel kecil
        for (let i = 0; i < 6; i++) {
          const particle = document.createElement('a-sphere');
          particle.setAttribute('radius', '0.05');
          particle.setAttribute('position', `${ballPosition.x} ${ballPosition.y} ${ballPosition.z}`);
          particle.setAttribute('material', 'color: #ffff00; emissive: #ffaa00; opacity: 0.8; transparent: true');
          
          // Animasi partikel terbang
          const randomX = (Math.random() - 0.5) * 2;
          const randomY = Math.random() * 1 + 0.5;
          const randomZ = (Math.random() - 0.5) * 2;
          
          particle.setAttribute('animation__fly', {
            property: 'position',
            to: `${ballPosition.x + randomX} ${ballPosition.y + randomY} ${ballPosition.z + randomZ}`,
            dur: 800,
            easing: 'easeOutQuart'
          });
          
          particle.setAttribute('animation__fade', {
            property: 'material.opacity',
            to: '0',
            dur: 800,
            easing: 'easeOutQuart'
          });
          
          particle.setAttribute('animation__shrink', {
            property: 'scale',
            to: '0.1 0.1 0.1',
            dur: 800,
            easing: 'easeOutQuart'
          });
          
          document.querySelector('a-scene').appendChild(particle);
          
          // Hapus partikel setelah animasi selesai
          setTimeout(() => {
            if (particle.parentNode) {
              particle.parentNode.removeChild(particle);
            }
          }, 1000);
        }
      }

      // Simulasi animasi untuk fallback model
      function animateBlock(state) {
        const block = document.querySelector('#blockModel');
        blockAnimationState = state;
        
        switch(state) {
          case 'skema1':
            // Sedikit bergetar
            block.setAttribute('animation', {
              property: 'position',
              to: '0.05 0 0',
              dur: 200,
              dir: 'alternate',
              loop: true
            });
            break;
          case 'skema2':
            // Bergetar lebih kuat
            block.setAttribute('animation', {
              property: 'position',
              to: '0.1 0 0',
              dur: 150,
              dir: 'alternate',
              loop: true
            });
            break;
          case 'skema3':
            // Bergerak sliding
            block.setAttribute('animation', {
              property: 'position',
              to: '1 0 0',
              dur: 1000,
              easing: 'easeInOutQuad',
              loop: true,
              dir: 'alternate'
            });
            break;
          default:
            // Reset ke posisi normal
            block.removeAttribute('animation');
            block.setAttribute('position', '0 0 0');
            break;
        }
      }

      // Event listeners untuk Bab 2 - Gaya Gesek
      document.querySelector('#btnSkema1').addEventListener('click', () => {
        if (modelsLoaded) {
          // Gunakan animasi GLB jika tersedia
          const modelEntity = document.querySelector('#myModel a-entity[gltf-model]');
          if (modelEntity) {
            modelEntity.setAttribute('animation-mixer', 'clip: Skema1; loop: repeat');
          }
        } else {
          // Gunakan animasi fallback
          animateBlock('skema1');
        }
        
        statusText.setAttribute('value', 'Kamu tarik perlahan. tetapi balok masih diam karena ada fs yang menahan');
        document.querySelector("#btnSkema2Wrapper").setAttribute("visible", "true");
        document.querySelector("#btnSkema2").classList.add("clickable"); 
      });

      document.querySelector('#btnSkema2').addEventListener('click', () => {
        if (modelsLoaded) {
          const modelEntity = document.querySelector('#myModel a-entity[gltf-model]');
          if (modelEntity) {
            modelEntity.setAttribute('animation-mixer', 'clip: Skema2; loop: repeat');
          }
        } else {
          animateBlock('skema2');
        }
        
        statusText.setAttribute('value', 'Semakin kamu tarik. fs yang menahan akan semakin besar');
        document.querySelector("#btnSkema3Wrapper").setAttribute("visible", "true");
        document.querySelector("#btnSkema3").classList.add("clickable"); 
      });

      document.querySelector('#btnSkema3').addEventListener('click', () => {
        if (modelsLoaded) {
          const modelEntity = document.querySelector('#myModel a-entity[gltf-model]');
          if (modelEntity) {
            modelEntity.setAttribute('animation-mixer', 'clip: Skema3; loop: repeat');
          }
        } else {
          animateBlock('skema3');
        }
        
        statusText.setAttribute('value', 'Kamu menarik sangat kuat. Balok akan ikut tertarik karena fs sudah berubah menjadi fk karena sudah mencapai maksimum');
      });

      document.querySelector('#btnReset2').addEventListener('click', () => {
        if (modelsLoaded) {
          const modelEntity = document.querySelector('#myModel a-entity[gltf-model]');
          if (modelEntity) {
            modelEntity.setAttribute('animation-mixer', 'clip: Idle; loop: repeat');
          }
        } else {
          animateBlock('idle');
        }
        
        statusText.setAttribute('value', 'Ada sebuah balok di permukaan kasar');
        document.querySelector("#btnSkema2Wrapper").setAttribute("visible", "false");
        document.querySelector("#btnSkema2").classList.remove("clickable"); 
        document.querySelector("#btnSkema3Wrapper").setAttribute("visible", "false");
        document.querySelector("#btnSkema3").classList.remove("clickable"); 
      });

      // Navigation - Main Menu
      document.querySelector('#btnBab2').addEventListener('click', () => {
        document.querySelector("#bab2").setAttribute("visible", true);
        document.querySelector("#mainmenu").setAttribute("visible", false);
        document.querySelector("#btnReset2").classList.add("clickable"); 
        document.querySelector("#btnKembali2").classList.add("clickable"); 
        document.querySelector("#btnSkema1").classList.add("clickable"); 
        document.querySelector("#btnBab2").classList.remove("clickable"); 
        document.querySelector("#btnBab3").classList.remove("clickable"); 
      });

      document.querySelector('#btnBab3').addEventListener('click', () => {
        document.querySelector("#bab3").setAttribute("visible", true);
        document.querySelector("#mainmenu").setAttribute("visible", false);
        document.querySelector("#btnBab2").classList.remove("clickable"); 
        document.querySelector("#btnBab3").classList.remove("clickable"); 
        document.querySelector("#btnKembali3").classList.add("clickable"); 
        document.querySelector("#btnPlay").classList.add("clickable"); 
        
        // Aktifkan semua tombol kontrol
        document.querySelector("#btnM11").classList.add("clickable"); 
        document.querySelector("#btnM12").classList.add("clickable"); 
        document.querySelector("#btnV11").classList.add("clickable"); 
        document.querySelector("#btnV12").classList.add("clickable"); 
        document.querySelector("#btnM21").classList.add("clickable"); 
        document.querySelector("#btnM22").classList.add("clickable"); 
        document.querySelector("#btnV21").classList.add("clickable"); 
        document.querySelector("#btnV22").classList.add("clickable"); 
        updateLabel();
      });

      // Navigation - Kembali dari Bab 2
      document.querySelector('#btnKembali2').addEventListener('click', () => {
        if (modelsLoaded) {
          const modelEntity = document.querySelector('#myModel a-entity[gltf-model]');
          if (modelEntity) {
            modelEntity.setAttribute('animation-mixer', 'clip: Idle; loop: repeat');
          }
        } else {
          animateBlock('idle');
        }
        
        statusText.setAttribute('value', 'Ada sebuah balok di permukaan kasar');
        document.querySelector("#btnSkema2Wrapper").setAttribute("visible", "false");
        document.querySelector("#btnSkema2").classList.remove("clickable"); 
        document.querySelector("#btnSkema3Wrapper").setAttribute("visible", "false");
        document.querySelector("#btnSkema3").classList.remove("clickable"); 
        document.querySelector("#bab2").setAttribute("visible", false);
        document.querySelector("#mainmenu").setAttribute("visible", true);
        document.querySelector("#btnReset2").classList.remove("clickable"); 
        document.querySelector("#btnKembali2").classList.remove("clickable"); 
        document.querySelector("#btnSkema1").classList.remove("clickable"); 
        document.querySelector("#btnBab2").classList.add("clickable"); 
        document.querySelector("#btnBab3").classList.add("clickable"); 
      });

      // Navigation - Kembali dari Bab 3
      document.querySelector('#btnKembali3').addEventListener('click', () => {
        resetBab3();
        document.querySelector("#bab3").setAttribute("visible", false);
        document.querySelector("#mainmenu").setAttribute("visible", true);
        document.querySelector("#btnBab2").classList.add("clickable"); 
        document.querySelector("#btnBab3").classList.add("clickable"); 
        removeAllBab3Clickables();
      });

      // Event listeners untuk kontrol massa dan kecepatan
      document.querySelector('#btnM11').addEventListener('click', () => {
        m1 = 1;
        updateLabel();
      });

      document.querySelector('#btnM12').addEventListener('click', () => {
        m1 = 2;
        updateLabel();
      });

      document.querySelector('#btnV11').addEventListener('click', () => {
        v1 = 1;
        updateLabel();
      });

      document.querySelector('#btnV12').addEventListener('click', () => {
        v1 = 2;
        updateLabel();
      });

      document.querySelector('#btnM21').addEventListener('click', () => {
        m2 = 1;
        updateLabel();
      });

      document.querySelector('#btnM22').addEventListener('click', () => {
        m2 = 2;
        updateLabel();
      });

      document.querySelector('#btnV21').addEventListener('click', () => {
        v2 = -1;
        updateLabel();
      });

      document.querySelector('#btnV22').addEventListener('click', () => {
        v2 = -2;
        updateLabel();
      });

      // Fungsi helper
      function hitungKecepatan(m1, v1, m2, v2) {
        const v1p = ((m1 - m2) * v1 + 2 * m2 * v2) / (m1 + m2);
        const v2p = ((m2 - m1) * v2 + 2 * m1 * v1) / (m1 + m2);
        return [v1p, v2p];
      }

      function updateLabel() {
        label1.setAttribute("value", `m1 = ${m1}kg\nv1 = ${v1}m/s`);
        label2.setAttribute("value", `m2 = ${m2}kg\nv2 = ${v2}m/s`);
      }

      function resetBab3() {
        animating = false;
        ball1.setAttribute("position", "-2 1 -3");
        ball2.setAttribute("position", "2 1 -3");
        ball1.removeAttribute("animation__go");
        ball2.removeAttribute("animation__go");
        ball1.removeAttribute("animation__after");
        ball2.removeAttribute("animation__after");
        ball1.removeAttribute("animation__bounce");
        ball2.removeAttribute("animation__bounce");
        
        // Reset trails
        console.log('Resetting all effects...');
        
        done = false;
        m1 = 1, v1 = 1;
        m2 = 1, v2 = -1;
        document.querySelector("#UImerahWrapper").setAttribute("visible", "true");
        document.querySelector("#UIbiruWrapper").setAttribute("visible", "true");
        document.querySelector("#btnPlayText").setAttribute("value", "Start");
        updateLabel();
      }

      function removeAllBab3Clickables() {
        document.querySelector("#btnKembali3").classList.remove("clickable"); 
        document.querySelector("#btnPlay").classList.remove("clickable"); 
        document.querySelector("#btnM11").classList.remove("clickable"); 
        document.querySelector("#btnM12").classList.remove("clickable"); 
        document.querySelector("#btnV11").classList.remove("clickable"); 
        document.querySelector("#btnV12").classList.remove("clickable"); 
        document.querySelector("#btnM21").classList.remove("clickable"); 
        document.querySelector("#btnM22").classList.remove("clickable"); 
        document.querySelector("#btnV21").classList.remove("clickable"); 
        document.querySelector("#btnV22").classList.remove("clickable"); 
      }

      // Event listener untuk tombol Play/Reset
      btnPlay.addEventListener("click", () => {
        if (done) {
          resetBab3();
          // Aktifkan kembali semua kontrol
          document.querySelector("#btnM11").classList.add("clickable"); 
          document.querySelector("#btnM12").classList.add("clickable"); 
          document.querySelector("#btnV11").classList.add("clickable"); 
          document.querySelector("#btnV12").classList.add("clickable"); 
          document.querySelector("#btnM21").classList.add("clickable"); 
          document.querySelector("#btnM22").classList.add("clickable"); 
          document.querySelector("#btnV21").classList.add("clickable"); 
          document.querySelector("#btnV22").classList.add("clickable"); 
        } else {
          // Nonaktifkan kontrol saat animasi berjalan
          document.querySelector("#btnM11").classList.remove("clickable"); 
          document.querySelector("#btnM12").classList.remove("clickable"); 
          document.querySelector("#btnV11").classList.remove("clickable"); 
          document.querySelector("#btnV12").classList.remove("clickable"); 
          document.querySelector("#btnM21").classList.remove("clickable"); 
          document.querySelector("#btnM22").classList.remove("clickable"); 
          document.querySelector("#btnV21").classList.remove("clickable"); 
          document.querySelector("#btnV22").classList.remove("clickable"); 
          document.querySelector("#UIbiruWrapper").setAttribute("visible", "false");
          document.querySelector("#UImerahWrapper").setAttribute("visible", "false");
          
          if (animating) return;
          animating = true;

          const [v1p, v2p] = hitungKecepatan(m1, v1, m2, v2);

          // Tampilkan speed trails jika kecepatan tinggi
          showSpeedTrails(1, v1, ball1.getAttribute('position'));
          showSpeedTrails(2, v2, ball2.getAttribute('position'));

          // Gerak mendekat
          ball1.setAttribute("animation__go", {
            property: "position", 
            to: "0 1 -3", 
            dur: 2000, 
            easing: "linear"
          });
          ball2.setAttribute("animation__go", {
            property: "position", 
            to: "0 1 -3", 
            dur: 2000, 
            easing: "linear"
          });

          setTimeout(() => {
            // Efek memantul saat tabrakan
            const impactIntensity = Math.sqrt(v1*v1 + v2*v2) / 3; // Intensitas berdasarkan kecepatan
            createBounceEffect(ball1, impactIntensity);
            createBounceEffect(ball2, impactIntensity);

            // Update label setelah tabrakan
            label1.setAttribute("value", `m1 = ${m1}kg\nv1' = ${v1p.toFixed(2)}m/s`);
            label2.setAttribute("value", `m2 = ${m2}kg\nv2' = ${v2p.toFixed(2)}m/s`);

            // Tampilkan speed trails setelah tabrakan jika kecepatan tinggi
            setTimeout(() => {
              showSpeedTrails(1, v1p, {x: 0, y: 1, z: -3});
              showSpeedTrails(2, v2p, {x: 0, y: 1, z: -3});
            }, 300);

            // Gerak menjauh
            if (Math.abs(v1p) > 0.01) {
              ball1.setAttribute("animation__after", {
                property: "position", 
                to: `${-2 + v1p} 1 -3`, 
                dur: 2000, 
                easing: "linear"
              });
            } else {
              ball1.setAttribute("position", "0 1 -4");
            }

            if (Math.abs(v2p) > 0.01) {
              ball2.setAttribute("animation__after", {
                property: "position", 
                to: `${2 + v2p} 1 -3`, 
                dur: 2000, 
                easing: "linear"
              });
            } else {
              ball2.setAttribute("position", "0 1 -3");
            }

            animating = false;
            done = true;
            document.querySelector("#btnPlayText").setAttribute("value", "Reset");
          }, 2100);
        }
      });

      // Inisialisasi
      updateLabel();

      // Player collider: stops the player from penetrating any .collidable object
      AFRAME.registerComponent('collider', {
        schema: { 
          distance: { default: 1.2 },
          debug: { default: false }
        },
        init: function () {
          this.raycaster = new THREE.Raycaster();
          this.lastSafePosition = new THREE.Vector3();
          this.directions = [
            new THREE.Vector3(0, 0, -1), // forward
            new THREE.Vector3(0, 0, 1), // backward
            new THREE.Vector3(-1, 0, 0), // left
            new THREE.Vector3(1, 0, 0), // right
            new THREE.Vector3(-0.7, 0, -0.7), // diagonal front-left
            new THREE.Vector3(0.7, 0, -0.7), // diagonal front-right
            new THREE.Vector3(-0.7, 0, 0.7), // diagonal back-left
            new THREE.Vector3(0.7, 0, 0.7), // diagonal back-right
          ];
          this.el.addEventListener('loaded', () => {
            this.el.object3D.getWorldPosition(this.lastSafePosition);
          });
        },
        tick: function (time, delta) {
          const collidableEls = this.el.sceneEl.querySelectorAll('.collidable');
          if (collidableEls.length === 0) return;

          const collidables = [];
          collidableEls.forEach((el) => {
            if (el.object3D) {
              collidables.push(el.object3D);
            }
          });

          let collision = false;
          const currentPosition = new THREE.Vector3();
          this.el.object3D.getWorldPosition(currentPosition);

          for (const dir of this.directions) {
            const worldDir = dir.clone().applyQuaternion(this.el.object3D.quaternion);
            this.raycaster.set(currentPosition, worldDir);
            this.raycaster.far = this.data.distance;
            const intersects = this.raycaster.intersectObjects(collidables, true);

            if (intersects.length > 0 && intersects[0].distance < this.data.distance) {
              const hitEl = intersects[0].object.el;
              
              if (this.data.debug) {
                console.log('Collision detected with:', hitEl ? hitEl.id : 'unknown', 'distance:', intersects[0].distance);
              }
              
              // Prevent penetration
              this.el.object3D.position.copy(this.lastSafePosition);
              collision = true;
              break;
            }
          }
          
          if (!collision) {
            this.el.object3D.getWorldPosition(this.lastSafePosition);
          }
        },
      });

      // Info untuk pengguna
      console.log('VR Fisika loaded successfully!');
      console.log('If GLB models fail to load due to CORS, fallback models will be used.');
      console.log('To use GLB models properly, serve this file from a local server (e.g., Live Server extension)');
    </script>
  </body>
</html>