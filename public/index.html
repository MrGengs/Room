<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>AR-Room</title>
    <script src="https://aframe.io/releases/1.7.0/aframe.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.8.1/socket.io.min.js"></script>
    <script src="/easyrtc/easyrtc.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/networked-aframe@0.14.0/dist/networked-aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/c-frame/aframe-extras@7.6.0/dist/aframe-extras.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/aframe-environment-component@1.5.0/dist/aframe-environment-component.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/c-frame/aframe-gltf-model-plus@1.0.0/dist/gltf-model-plus.min.js"></script>
    <script>
      window.uiSettings = {
        showRandomAvatarButton: true,
        showDieButton: true,
      };
    </script>
    <script src="/dist/components.js"></script>
    <script defer src="/dist/ui.js"></script>
  </head>
  <body>
    <a-scene
      light="defaultLightsEnabled:false"
      renderer="stencil:true"
      networked-scene="
        connectOnLoad: false;
        room: lobby;
        debug: true;
        adapter: wseasyrtc;
        audio: false;
        video: false;"
      shadow="type: pcfsoft"
      gltf-model="meshoptDecoderPath:https://unpkg.com/meshoptimizer@0.19.0/meshopt_decoder.js"
      raycaster="far: 100; objects: .clickable,[link];"
      cursor="rayOrigin: mouse"
    >
      <a-assets>
        <img id="thumbScene1" crossorigin="anonymous" src="https://cdn.aframe.io/link-traversal/thumbs/forest.png" />
        <a-asset-item id="avatar-male-model" src="SittingIdle_man.fbx"></a-asset-item>
        <a-asset-item id="avatar-female-model" src="SittingIdle_woman.fbx"></a-asset-item>
        <a-asset-item id="pohon1-model" src="assets/pohon1.glb"></a-asset-item>
        <a-asset-item id="pohon2-model" src="assets/pohon2.glb"></a-asset-item>
        <template id="avatar-template">
          <a-entity player-info>
            <a-entity class="model" animation-mixer>
              <a-text class="nametag" align="center" value="?" position="0 2.1 0" scale=".5 .5 .5"></a-text>
            </a-entity>
            <a-entity class="camera" position="0 1.6 0"></a-entity>
          </a-entity>
        </template>
      </a-assets>

      <a-gltf-model id="world-nav-mesh" src="assets/world.glb" nav-mesh class="collidable"></a-gltf-model>

      <a-text value="Selamat Datang Di AR-Room" align="center" position="0 2 -4" scale="1.5 1.5 1.5"></a-text>

      <a-link
        change-room="on:obbcollisionstarted;room:scene1;url:scene1.html"
        link="on:click"
        href="scene1.html"
        title="Go To World 1"
        image="#thumbScene1"
        position="3 1.6 -5"
        class="clickable collidable"
        event-set__mouseenter="material.opacity: 0.8"
        event-set__mouseleave="material.opacity: 0.6"
      >
      </a-link>

      <a-link
        change-room="on:obbcollisionstarted;room:scene2;url:scene2.html"
        link="on:click"
        href="scene2.html"
        title="Go To World 2"
        image="#thumbScene1"
        position="-3 1.6 -5"
        class="clickable collidable"
        event-set__mouseenter="material.opacity: 0.8"
        event-set__mouseleave="material.opacity: 0.6"
      >
      </a-link>

      <a-entity id="scene">
        <!-- World GLB model -->
        <a-gltf-model src="assets/world.glb" position="0 0.2 0" scale="1 1 1" rotation="0 0 0"></a-gltf-model>

        <!-- Interior walls to prevent escape from inside world.glb -->
        <!-- These walls form the interior boundaries of the world -->

        <!-- Ultra small interior nav-mesh -->
        <a-box nav-mesh position="0 0 0" width="3" height="0.1" depth="3" visible="false"></a-box>

        <!-- Ultra tight boundary walls -->
        <!-- East interior wall -->
        <a-box nav-mesh position="1.5 2 0" width="0.1" height="4" depth="3" visible="false"></a-box>
        <!-- West interior wall -->
        <a-box nav-mesh position="-1.5 2 0" width="0.1" height="4" depth="3" visible="false"></a-box>
        <!-- North interior wall -->
        <a-box nav-mesh position="0 2 1.5" width="3" height="4" depth="0.1" visible="false"></a-box>
        <!-- South interior wall -->
        <a-box nav-mesh position="0 2 -1.5" width="3" height="4" depth="0.1" visible="false"></a-box>

        <!-- Corner blocks (extremely close) -->
        <a-box nav-mesh position="1.4 2 1.4" width="0.3" height="4" depth="0.3" visible="false"></a-box>
        <a-box nav-mesh position="-1.4 2 1.4" width="0.3" height="4" depth="0.3" visible="false"></a-box>
        <a-box nav-mesh position="1.4 2 -1.4" width="0.3" height="4" depth="0.3" visible="false"></a-box>
        <a-box nav-mesh position="-1.4 2 -1.4" width="0.3" height="4" depth="0.3" visible="false"></a-box>

        <!-- Ground -->
        <a-plane position="0 0 0" rotation="-90 0 0" width="100" height="100" color="#4A4A4A" visible="true"></a-plane>
        <a-entity light="type:ambient;intensity:0.5"></a-entity>
        
        <!-- Trees - Pohon Area 1 (Depan Kiri) -->
        <a-entity id="pohon-1" gltf-model="#pohon1-model" position="-8 0 -8" scale="1.5 1.5 1.5" rotation="0 45 0" class="collidable"></a-entity>
        <a-entity id="pohon-2" gltf-model="#pohon2-model" position="-6 0.5 -10" scale="2.4 2.4 2.4" rotation="0 120 0" class="collidable">
          <a-box position="0 2 0" width="2" height="4" depth="2" visible="false" class="collidable"></a-box>
        </a-entity>
        <a-entity id="pohon-3" gltf-model="#pohon1-model" position="-10 0 -6" scale="1.8 1.8 1.8" rotation="0 270 0" class="collidable"></a-entity>
        
        <!-- Trees - Pohon Area 2 (Depan Kanan) -->
        <a-entity id="pohon-4" gltf-model="#pohon2-model" position="8 0.5 -8" scale="2.8 2.8 2.8" rotation="0 180 0" class="collidable">
          <a-box position="0 2.2 0" width="2.2" height="4.4" depth="2.2" visible="false" class="collidable"></a-box>
        </a-entity>
        <a-entity id="pohon-5" gltf-model="#pohon1-model" position="6 0 -10" scale="1.6 1.6 1.6" rotation="0 90 0" class="collidable"></a-entity>
        <a-entity id="pohon-6" gltf-model="#pohon2-model" position="10 0.5 -6" scale="2.6 2.6 2.6" rotation="0 315 0" class="collidable">
          <a-box position="0 2.1 0" width="2.1" height="4.2" depth="2.1" visible="false" class="collidable"></a-box>
        </a-entity>
        
        <!-- Trees - Pohon Area 3 (Belakang Kiri) -->
        <a-entity id="pohon-7" gltf-model="#pohon1-model" position="-8 0 8" scale="1.7 1.7 1.7" rotation="0 60 0" class="collidable"></a-entity>
        <a-entity id="pohon-8" gltf-model="#pohon2-model" position="-6 0.5 10" scale="2.2 2.2 2.2" rotation="0 200 0" class="collidable">
          <a-box position="0 1.9 0" width="1.9" height="3.8" depth="1.9" visible="false" class="collidable"></a-box>
        </a-entity>
        <a-entity id="pohon-9" gltf-model="#pohon1-model" position="-10 0 6" scale="1.9 1.9 1.9" rotation="0 150 0" class="collidable"></a-entity>
        
        <!-- Trees - Pohon Area 4 (Belakang Kanan) -->
        <a-entity id="pohon-10" gltf-model="#pohon2-model" position="8 0.5 8" scale="3.0 3.0 3.0" rotation="0 30 0" class="collidable">
          <a-box position="0 2.3 0" width="2.3" height="4.6" depth="2.3" visible="false" class="collidable"></a-box>
        </a-entity>
        <a-entity id="pohon-11" gltf-model="#pohon1-model" position="6 0 10" scale="1.3 1.3 1.3" rotation="0 240 0" class="collidable"></a-entity>
        <a-entity id="pohon-12" gltf-model="#pohon2-model" position="10 0.5 6" scale="3.2 3.2 3.2" rotation="0 75 0" class="collidable">
          <a-box position="0 2.4 0" width="2.4" height="4.8" depth="2.4" visible="false" class="collidable"></a-box>
        </a-entity>
        
        <!-- Trees - Pohon Area 5 (Samping Kiri) -->
        <a-entity id="pohon-13" gltf-model="#pohon1-model" position="-12 0 0" scale="1.4 1.4 1.4" rotation="0 135 0" class="collidable"></a-entity>
        <a-entity id="pohon-14" gltf-model="#pohon2-model" position="-14 0.5 2" scale="3.4 3.4 3.4" rotation="0 300 0" class="collidable">
          <a-box position="0 2.5 0" width="2.5" height="5" depth="2.5" visible="false" class="collidable"></a-box>
        </a-entity>
        <a-entity id="pohon-15" gltf-model="#pohon1-model" position="-14 0 -2" scale="1.2 1.2 1.2" rotation="0 45 0" class="collidable"></a-entity>
        
        <!-- Trees - Pohon Area 6 (Samping Kanan) -->
        <a-entity id="pohon-16" gltf-model="#pohon2-model" position="12 0.5 0" scale="3.6 3.6 3.6" rotation="0 225 0" class="collidable">
          <a-box position="0 2.6 0" width="2.6" height="5.2" depth="2.6" visible="false" class="collidable"></a-box>
        </a-entity>
        <a-entity id="pohon-17" gltf-model="#pohon1-model" position="14 0 2" scale="1.1 1.1 1.1" rotation="0 15 0" class="collidable"></a-entity>
        <a-entity id="pohon-18" gltf-model="#pohon2-model" position="14 0.5 -2" scale="3.0 3.0 3.0" rotation="0 165 0" class="collidable">
          <a-box position="0 2.3 0" width="2.3" height="4.6" depth="2.3" visible="false" class="collidable"></a-box>
        </a-entity>
        
        <!-- Trees - Pohon Area 7 (Jauh Depan) -->
        <a-entity id="pohon-19" gltf-model="#pohon1-model" position="0 0 -12" scale="1.6 1.6 1.6" rotation="0 90 0" class="collidable"></a-entity>
        <a-entity id="pohon-20" gltf-model="#pohon2-model" position="-2 0.5 -14" scale="2.6 2.6 2.6" rotation="0 210 0" class="collidable">
          <a-box position="0 2.1 0" width="2.1" height="4.2" depth="2.1" visible="false" class="collidable"></a-box>
        </a-entity>
        <a-entity id="pohon-21" gltf-model="#pohon1-model" position="2 0 -14" scale="1.7 1.7 1.7" rotation="0 330 0" class="collidable"></a-entity>
        
        <!-- Trees - Pohon Area 8 (Jauh Belakang) -->
        <a-entity id="pohon-22" gltf-model="#pohon2-model" position="0 0.5 12" scale="2.8 2.8 2.8" rotation="0 270 0" class="collidable">
          <a-box position="0 2.2 0" width="2.2" height="4.4" depth="2.2" visible="false" class="collidable"></a-box>
        </a-entity>
        <a-entity id="pohon-23" gltf-model="#pohon1-model" position="-2 0 14" scale="1.8 1.8 1.8" rotation="0 120 0" class="collidable"></a-entity>
        <a-entity id="pohon-24" gltf-model="#pohon2-model" position="2 0.5 14" scale="2.4 2.4 2.4" rotation="0 60 0" class="collidable">
          <a-box position="0 2 0" width="2" height="4" depth="2" visible="false" class="collidable"></a-box>
        </a-entity>
      </a-entity>

      <a-entity
        id="rig"
        movement-controls="constrainToNavMesh: true; speed: 0.3"
        spawn-in-circle="radius:1"
        networked="template:#avatar-template;attachTemplateToLocal:false"
        player-info
      >
        <a-entity id="player" class="camera" camera position="0 1.6 0" look-controls>
          <a-entity
            position="0 0 -1"
            geometry="primitive: ring; radiusInner: 0.018; radiusOuter: 0.025"
            material="shader: flat; opacity: 0.9"
            cursor="fuse: true; fuseTimeout: 1200"
            raycaster="objects: .clickable; far: 20;"
            animation__fuse="property: scale; startEvents: fusing; from: 1 1 1; to: 0.2 0.2 0.2; dur: 1200; easing: linear"
            animation__reset="property: scale; startEvents: mouseleave; to: 1 1 1; dur: 120"
          >
          </a-entity>
        </a-entity>
        <a-entity id="left-hand" networked-hand-controls="hand: left" laser-controls="hand: left"></a-entity>
        <a-entity id="right-hand" networked-hand-controls="hand:right" laser-controls="hand: right"></a-entity>
      </a-entity>
    </a-scene>
  </body>
</html>
